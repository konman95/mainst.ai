{"version":3,"sources":["../../../../lib/api.ts","../../../../app/chat/page.tsx"],"sourcesContent":["import { getAuth } from \"./auth\";\nconst BASE = process.env.NEXT_PUBLIC_API_BASE_URL || \"http://localhost:8000\";\nconst USE_MOCK = (process.env.NEXT_PUBLIC_USE_MOCK || \"false\") === \"true\";\n\nfunction isMockEnabled(): boolean {\n  if (typeof window !== \"undefined\") {\n    const runtime = localStorage.getItem(\"USE_MOCK\");\n    if (runtime === \"true\") return true;\n    if (runtime === \"false\") return false;\n  }\n  return USE_MOCK;\n}\n\nfunction buildUrl(path: string) {\n  if (isMockEnabled()) return `/api/mock${path}`;\n  return BASE + path;\n}\n\nasync function req(path: string, body?: any, method?: string) {\n  const auth = getAuth();\n  let res: Response;\n  try {\n    res = await fetch(buildUrl(path), {\n      method: method || (body ? \"POST\" : \"GET\"),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...(auth ? { Authorization: `Bearer ${auth.token}` } : {})\n      },\n      body: body ? JSON.stringify(body) : undefined\n    });\n  } catch (e: any) {\n    throw new Error(\"Network error: \" + (e?.message || String(e)));\n  }\n\n  if (!res.ok) {\n    const text = await res.text().catch(() => `HTTP ${res.status}`);\n    throw new Error(text);\n  }\n\n  try {\n    return await res.json();\n  } catch (e) {\n    return null;\n  }\n}\n\nexport const api = {\n  health: () => req(\"/health\"),\n  chat: (b: any) => req(\"/chat\", b),\n  ownerGet: () => req(\"/ownercover/settings\"),\n  ownerSet: (b: any) => req(\"/ownercover/settings\", b),\n  ownerInbound: (b: any) => req(\"/ownercover/handleInbound\", b),\n  contacts: () => req(\"/contacts\"),\n  createContact: (b: any) => req(\"/contacts\", b, \"POST\"),\n  updateContact: (id: string, b: any) => req(`/contacts/${id}`, b, \"PUT\"),\n  deleteContact: (id: string) => req(`/contacts/${id}`, undefined, \"DELETE\")\n};\n","\"use client\";\nimport { useState } from \"react\";\nimport { api } from \"../../lib/api\";\n\nexport default function Chat() {\n  const [msg,setMsg]=useState(\"\");\n  const [out,setOut]=useState(\"\");\n  const [error,setError]=useState<string | null>(null);\n  const [loading,setLoading]=useState(false);\n  return (\n    <div>\n      <h2>Chat</h2>\n      <input className=\"input\" value={msg} onChange={e=>setMsg(e.target.value)} />\n      <button className=\"btn\" disabled={loading} onClick={async()=>{\n        setLoading(true);\n        setError(null);\n        try {\n          const r=await api.chat({message:msg});\n          setOut(r?.reply ?? \"\");\n        } catch (e:any) {\n          setError(e?.message || String(e));\n        } finally {\n          setLoading(false);\n        }\n      }}>{loading ? \"Sending...\" : \"Send\"}</button>\n      {error && <div className=\"muted\">Error: {error}</div>}\n      <pre>{out}</pre>\n    </div>\n  );\n}\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAkBA,eAAe,EAAI,CAAY,CAAE,CAAU,CAAE,CAAe,EAC1D,IACI,EADE,EAAO,CAAA,EAAA,EAAA,OAAA,AAAO,IAEpB,GAAI,CACF,EAAM,MAAM,MARc,AAQR,CARS,SAAS,EAQT,AARW,EAAA,CAAM,CAQV,CAChC,OAAQ,GAAW,GAAO,IAAR,GAAiB,KAAA,CAAK,CACxC,QAAS,CACP,eAAgB,mBAChB,GAAI,EAAO,CAAE,cAAe,CAAC,OAAO,EAAE,EAAK,KAAK,CAAA,CAAG,AAAD,EAAK,CAAC,CAAC,AAC3D,EACA,KAAM,EAAO,KAAK,SAAS,CAAC,GAAQ,MACtC,EACF,CAAE,MAAO,EAAQ,CACf,MAAM,AAAI,MAAM,mBAAqB,CAAD,EAAI,SAAW,OAAO,EAAA,CAAE,CAC9D,CAEA,GAAI,CAAC,EAAI,EAAE,CAET,CAFW,KAEL,AAAI,MADG,AACG,MADG,EAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,KAAK,EAAE,EAAI,MAAM,CAAA,CAAE,GAIhE,GAAI,CACF,OAAO,MAAM,EAAI,IAAI,EACvB,CAAE,MAAO,EAAG,CACV,OAAO,IACT,CACF,cAEmB,CACjB,OAAQ,IAAM,EAAI,WAClB,KAAM,AAAC,GAAW,EAAI,QAAS,GAC/B,SAAU,IAAM,EAAI,wBACpB,SAAU,AAAC,GAAW,EAAI,uBAAwB,GAClD,aAAc,AAAC,GAAW,EAAI,4BAA6B,GAC3D,SAAU,IAAM,EAAI,aACpB,cAAe,AAAC,GAAW,EAAI,YAAa,EAAG,QAC/C,cAAe,CAAC,EAAY,IAAW,EAAI,CAAC,UAAU,EAAE,EAAA,CAAI,CAAE,EAAG,OACjE,cAAe,AAAC,GAAe,EAAI,CAAC,UAAU,EAAE,EAAA,CAAI,MAAE,EAAW,SACnE,6CCvDA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACtB,GAAM,CAAC,EAAI,EAAO,CAAC,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACtB,CAAC,EAAI,EAAO,CAAC,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACtB,CAAC,EAAM,EAAS,CAAC,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACzC,CAAC,EAAQ,EAAW,CAAC,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACpC,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,SACJ,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,QAAQ,MAAO,EAAK,SAAU,GAAG,EAAO,EAAE,MAAM,CAAC,KAAK,IACvE,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,MAAM,SAAU,EAAS,QAAS,UAClD,GAAW,GACX,EAAS,MACT,GAAI,CACF,IAAM,EAAE,MAAM,EAAA,GAAG,CAAC,IAAI,CAAC,CAAC,QAAQ,CAAG,GACnC,EAAO,GAAG,OAAS,GACrB,CAAE,MAAO,EAAO,CACd,EAAS,GAAG,SAAW,OAAO,GAChC,QAAU,CACR,GAAW,EACb,CACF,WAAI,EAAU,aAAe,SAC5B,GAAS,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kBAAQ,UAAQ,KACzC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UAAK,MAGZ"}