{"version":3,"sources":["../../../../lib/api.ts","../../../../app/owner-cover/page.tsx"],"sourcesContent":["import { getAuth } from \"./auth\";\nconst BASE = process.env.NEXT_PUBLIC_API_BASE_URL || \"http://localhost:8000\";\nconst USE_MOCK = (process.env.NEXT_PUBLIC_USE_MOCK || \"false\") === \"true\";\n\nfunction isMockEnabled(): boolean {\n  if (typeof window !== \"undefined\") {\n    const runtime = localStorage.getItem(\"USE_MOCK\");\n    if (runtime === \"true\") return true;\n    if (runtime === \"false\") return false;\n  }\n  return USE_MOCK;\n}\n\nfunction buildUrl(path: string) {\n  if (isMockEnabled()) return `/api/mock${path}`;\n  return BASE + path;\n}\n\nasync function req(path: string, body?: any, method?: string) {\n  const auth = getAuth();\n  let res: Response;\n  try {\n    res = await fetch(buildUrl(path), {\n      method: method || (body ? \"POST\" : \"GET\"),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...(auth ? { Authorization: `Bearer ${auth.token}` } : {})\n      },\n      body: body ? JSON.stringify(body) : undefined\n    });\n  } catch (e: any) {\n    throw new Error(\"Network error: \" + (e?.message || String(e)));\n  }\n\n  if (!res.ok) {\n    const text = await res.text().catch(() => `HTTP ${res.status}`);\n    throw new Error(text);\n  }\n\n  try {\n    return await res.json();\n  } catch (e) {\n    return null;\n  }\n}\n\nexport const api = {\n  health: () => req(\"/health\"),\n  chat: (b: any) => req(\"/chat\", b),\n  ownerGet: () => req(\"/ownercover/settings\"),\n  ownerSet: (b: any) => req(\"/ownercover/settings\", b),\n  ownerInbound: (b: any) => req(\"/ownercover/handleInbound\", b),\n  contacts: () => req(\"/contacts\"),\n  createContact: (b: any) => req(\"/contacts\", b, \"POST\"),\n  updateContact: (id: string, b: any) => req(`/contacts/${id}`, b, \"PUT\"),\n  deleteContact: (id: string) => req(`/contacts/${id}`, undefined, \"DELETE\")\n};\n","\"use client\";\nimport { useEffect,useState } from \"react\";\nimport { api } from \"../../lib/api\";\n\nexport default function OwnerCover() {\n  const [settings,setSettings]=useState<any>(null);\n  const [error,setError]=useState<string | null>(null);\n  const [loading,setLoading]=useState(true);\n\n  useEffect(()=>{\n    let active = true;\n    async function load() {\n      setLoading(true);\n      setError(null);\n      try {\n        const data = await api.ownerGet();\n        if (active) setSettings(data);\n      } catch (e:any) {\n        if (active) setError(e?.message || String(e));\n      } finally {\n        if (active) setLoading(false);\n      }\n    }\n    load();\n    return () => { active = false; };\n  },[]);\n  return (\n    <div>\n      <h2>Owner Cover</h2>\n      {loading ? (\n        <div className=\"muted\">Loading...</div>\n      ) : error ? (\n        <div className=\"muted\">Error: {error}</div>\n      ) : (\n        <pre>{JSON.stringify(settings,null,2)}</pre>\n      )}\n      <button className=\"btn\" onClick={async()=>{\n        try {\n          const r=await api.ownerInbound({\n            contact_id:\"lead-1\",\n            channel:\"webchat\",\n            text:\"How much does it cost?\"\n          });\n          alert(JSON.stringify(r,null,2));\n        } catch (e:any) {\n          setError(e?.message || String(e));\n        }\n      }}>Simulate Inbound</button>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}