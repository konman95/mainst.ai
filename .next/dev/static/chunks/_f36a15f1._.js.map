{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/lib/api.ts"],"sourcesContent":["import { getAuth } from \"./auth\";\nconst BASE =\n  process.env.NEXT_PUBLIC_API_BASE_URL ||\n  (typeof window !== \"undefined\" ? \"/api\" : \"http://localhost:8000\");\nconst USE_MOCK = (process.env.NEXT_PUBLIC_USE_MOCK || \"false\") === \"true\";\n\nfunction isMockEnabled(): boolean {\n  if (typeof window !== \"undefined\") {\n    const runtime = localStorage.getItem(\"USE_MOCK\");\n    if (runtime === \"true\") return true;\n    if (runtime === \"false\") return false;\n  }\n  return USE_MOCK;\n}\n\nconst MOCK_PATHS = [\"/health\", \"/contacts\", \"/chat\", \"/ownercover\", \"/profile\"];\n\nfunction buildUrl(path: string) {\n  if (isMockEnabled() && MOCK_PATHS.some(p => path === p || path.startsWith(`${p}/`))) {\n    return `/api/mock${path}`;\n  }\n  return BASE + path;\n}\n\nasync function req(path: string, body?: any, method?: string) {\n  const auth = getAuth();\n  let res: Response;\n  try {\n    res = await fetch(buildUrl(path), {\n      method: method || (body ? \"POST\" : \"GET\"),\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...(auth ? { Authorization: `Bearer ${auth.token}` } : {})\n      },\n      body: body ? JSON.stringify(body) : undefined\n    });\n  } catch (e: any) {\n    throw new Error(\"Network error: \" + (e?.message || String(e)));\n  }\n\n  if (!res.ok) {\n    const text = await res.text().catch(() => `HTTP ${res.status}`);\n    throw new Error(text);\n  }\n\n  try {\n    return await res.json();\n  } catch (e) {\n    return null;\n  }\n}\n\nexport const api = {\n  health: () => req(\"/health\"),\n  chat: (b: any) => req(\"/chat\", b),\n  chatManual: (b: any) => req(\"/chat/manual\", b),\n  chatHistory: (conversationId: string) =>\n    req(`/chat/history?conversationId=${encodeURIComponent(conversationId)}`),\n  ownerGet: () => req(\"/ownercover/settings\"),\n  ownerSet: (b: any) => req(\"/ownercover/settings\", b),\n  ownerInbound: (b: any) => req(\"/ownercover/handleInbound\", b),\n  profileGet: () => req(\"/profile\"),\n  profileSet: (b: any) => req(\"/profile\", b, \"POST\"),\n  contacts: () => req(\"/contacts\"),\n  createContact: (b: any) => req(\"/contacts\", b, \"POST\"),\n  updateContact: (id: string, b: any) => req(`/contacts/${id}`, b, \"PUT\"),\n  deleteContact: (id: string) => req(`/contacts/${id}`, undefined, \"DELETE\"),\n  decisions: (contactId?: string) =>\n    req(contactId ? `/decisions?contact_id=${encodeURIComponent(contactId)}` : \"/decisions\"),\n  actionQueue: () => req(\"/actionQueue\"),\n  approveAction: (actionId: string, approve: boolean) =>\n    req(\"/actionQueue/approve\", { action_id: actionId, approve }, \"POST\"),\n  audit: () => req(\"/auditLog\"),\n  outcomes: (contactId?: string) =>\n    req(contactId ? `/outcomes?contact_id=${encodeURIComponent(contactId)}` : \"/outcomes\"),\n  createOutcome: (b: any) => req(\"/outcomes\", b, \"POST\"),\n  threads: (contactId?: string) =>\n    req(contactId ? `/threads?contact_id=${encodeURIComponent(contactId)}` : \"/threads\"),\n  threadMessages: (threadId: string) => req(`/threads/${encodeURIComponent(threadId)}/messages`),\n  dashboardSummary: () => req(\"/dashboard/summary\")\n};\n"],"names":[],"mappings":";;;;AAEE;AAFF;;AACA,MAAM,OACJ,2KAAO,CAAC,GAAG,CAAC,wBAAwB,IACpC,CAAC,uCAAgC,SAAS,uBAAuB;AACnE,MAAM,WAAW,CAAC,2KAAO,CAAC,GAAG,CAAC,oBAAoB,IAAI,OAAO,MAAM;AAEnE,SAAS;IACP,wCAAmC;QACjC,MAAM,UAAU,aAAa,OAAO,CAAC;QACrC,IAAI,YAAY,QAAQ,OAAO;QAC/B,IAAI,YAAY,SAAS,OAAO;IAClC;IACA,OAAO;AACT;AAEA,MAAM,aAAa;IAAC;IAAW;IAAa;IAAS;IAAe;CAAW;AAE/E,SAAS,SAAS,IAAY;IAC5B,IAAI,mBAAmB,WAAW,IAAI,CAAC,CAAA,IAAK,SAAS,KAAK,KAAK,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC,IAAI;QACnF,OAAO,CAAC,SAAS,EAAE,MAAM;IAC3B;IACA,OAAO,OAAO;AAChB;AAEA,eAAe,IAAI,IAAY,EAAE,IAAU,EAAE,MAAe;IAC1D,MAAM,OAAO,IAAA,yHAAO;IACpB,IAAI;IACJ,IAAI;QACF,MAAM,MAAM,MAAM,SAAS,OAAO;YAChC,QAAQ,UAAU,CAAC,OAAO,SAAS,KAAK;YACxC,SAAS;gBACP,gBAAgB;gBAChB,GAAI,OAAO;oBAAE,eAAe,CAAC,OAAO,EAAE,KAAK,KAAK,EAAE;gBAAC,IAAI,CAAC,CAAC;YAC3D;YACA,MAAM,OAAO,KAAK,SAAS,CAAC,QAAQ;QACtC;IACF,EAAE,OAAO,GAAQ;QACf,MAAM,IAAI,MAAM,oBAAoB,CAAC,GAAG,WAAW,OAAO,EAAE;IAC9D;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,KAAK,EAAE,IAAI,MAAM,EAAE;QAC9D,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,MAAM,MAAM;IACjB,QAAQ,IAAM,IAAI;IAClB,MAAM,CAAC,IAAW,IAAI,SAAS;IAC/B,YAAY,CAAC,IAAW,IAAI,gBAAgB;IAC5C,aAAa,CAAC,iBACZ,IAAI,CAAC,6BAA6B,EAAE,mBAAmB,iBAAiB;IAC1E,UAAU,IAAM,IAAI;IACpB,UAAU,CAAC,IAAW,IAAI,wBAAwB;IAClD,cAAc,CAAC,IAAW,IAAI,6BAA6B;IAC3D,YAAY,IAAM,IAAI;IACtB,YAAY,CAAC,IAAW,IAAI,YAAY,GAAG;IAC3C,UAAU,IAAM,IAAI;IACpB,eAAe,CAAC,IAAW,IAAI,aAAa,GAAG;IAC/C,eAAe,CAAC,IAAY,IAAW,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG;IACjE,eAAe,CAAC,KAAe,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,WAAW;IACjE,WAAW,CAAC,YACV,IAAI,YAAY,CAAC,sBAAsB,EAAE,mBAAmB,YAAY,GAAG;IAC7E,aAAa,IAAM,IAAI;IACvB,eAAe,CAAC,UAAkB,UAChC,IAAI,wBAAwB;YAAE,WAAW;YAAU;QAAQ,GAAG;IAChE,OAAO,IAAM,IAAI;IACjB,UAAU,CAAC,YACT,IAAI,YAAY,CAAC,qBAAqB,EAAE,mBAAmB,YAAY,GAAG;IAC5E,eAAe,CAAC,IAAW,IAAI,aAAa,GAAG;IAC/C,SAAS,CAAC,YACR,IAAI,YAAY,CAAC,oBAAoB,EAAE,mBAAmB,YAAY,GAAG;IAC3E,gBAAgB,CAAC,WAAqB,IAAI,CAAC,SAAS,EAAE,mBAAmB,UAAU,SAAS,CAAC;IAC7F,kBAAkB,IAAM,IAAI;AAC9B"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/app/chat/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../lib/api\";\n\nexport default function Chat() {\n  const [msg,setMsg]=useState(\"\");\n  const [out,setOut]=useState(\"\");\n  const [error,setError]=useState<string | null>(null);\n  const [loading,setLoading]=useState(false);\n  const [conversationId,setConversationId]=useState(\"\");\n  const [messages,setMessages]=useState<any[]>([]);\n  const [manual,setManual]=useState(\"\");\n\n  useEffect(()=>{\n    let active = true;\n    async function loadHistory() {\n      try {\n        const data = await api.chatHistory(conversationId);\n        if (active) setMessages(data || []);\n      } catch (e:any) {\n        if (active) setError(e?.message || String(e));\n      }\n    }\n    loadHistory();\n    const interval = setInterval(loadHistory, 5000);\n    return () => {\n      active = false;\n      clearInterval(interval);\n    };\n  },[conversationId]);\n\n  async function refreshHistory(nextId: string) {\n    const data = await api.chatHistory(nextId);\n    setMessages(data || []);\n  }\n\n  return (\n    <div className=\"stagger\">\n      <div>\n        <span className=\"pill\">Smart Chat</span>\n        <h2 className=\"section-title\">Live conversation</h2>\n        <p className=\"muted\">Calm, professional responses that match your business voice.</p>\n      </div>\n\n      <div className=\"card\">\n        <div className=\"row\" style={{ alignItems: \"center\", justifyContent: \"space-between\" }}>\n          <strong>Conversation</strong>\n          <span className=\"badge\">Owner ready</span>\n        </div>\n        <div className=\"card tight\" style={{ marginTop: 16 }}>\n          {messages.length === 0 ? (\n            <div className=\"muted\">No messages yet.</div>\n          ) : (\n            <div className=\"timeline\">\n              {messages.map((m:any, idx:number) => (\n                <div className=\"timeline-item\" key={`${m.createdAt}-${idx}`}>\n                  <span className=\"dot\" />\n                  <div>\n                    <strong>{m.role === \"assistant\" ? \"Assistant\" : \"Customer\"}</strong>\n                    <div className=\"muted\">{m.text || m.content}</div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n        <div style={{ marginTop: 16 }}>\n          <input\n            className=\"input\"\n            placeholder=\"Type a customer question...\"\n            value={msg}\n            onChange={e=>setMsg(e.target.value)}\n          />\n        </div>\n        <div className=\"hero-actions\">\n          <button className=\"btn primary\" disabled={loading} onClick={async()=>{\n            setLoading(true);\n            setError(null);\n            try {\n              const r=await api.chat({message:msg, conversationId});\n              setOut(r?.reply ?? \"\");\n              if (r?.thread_id) setConversationId(r.thread_id);\n              await refreshHistory(r?.thread_id || conversationId);\n            } catch (e:any) {\n              setError(e?.message || String(e));\n            } finally {\n              setLoading(false);\n            }\n          }}>{loading ? \"Sending...\" : \"Send reply\"}</button>\n          <button className=\"btn ghost\" onClick={()=>{ setMsg(\"\"); setOut(\"\"); }}>Clear</button>\n        </div>\n        {error && <div className=\"muted\">Error: {error}</div>}\n        <div className=\"card tight\" style={{ marginTop: 16 }}>\n          <div className=\"muted\" style={{ marginBottom: 8 }}>Suggested response</div>\n          <pre style={{ margin: 0 }}>{out || \"No response yet.\"}</pre>\n        </div>\n        <div style={{ marginTop: 16 }}>\n          <div className=\"muted\" style={{ marginBottom: 8 }}>Manual override</div>\n          <textarea\n            className=\"textarea\"\n            placeholder=\"Edit or write a manual response...\"\n            value={manual}\n            onChange={e=>setManual(e.target.value)}\n          />\n          <div className=\"row\" style={{ marginTop: 8 }}>\n            <button\n              className=\"btn ghost\"\n              onClick={async()=>{\n                if (!manual.trim()) return;\n                try {\n                  await api.chatManual({ conversationId, response: manual });\n                  setManual(\"\");\n                  await refreshHistory(conversationId);\n                } catch (e:any) {\n                  setError(e?.message || String(e));\n                }\n              }}\n            >\n              Send manual reply\n            </button>\n          </div>\n        </div>\n        <div className=\"row\" style={{ marginTop: 12 }}>\n          <span className=\"badge\">Conversation: {conversationId || \"default\"}</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}