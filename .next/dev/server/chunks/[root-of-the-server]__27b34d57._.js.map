{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/lib/firebaseServer.ts"],"sourcesContent":["import { initializeApp, getApps, getApp } from \"firebase/app\";\nimport { getFirestore } from \"firebase/firestore\";\n\nconst firebaseConfig = {\n  apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n  authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL,\n  projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n  measurementId: process.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID\n};\n\nconst app = getApps().length ? getApp() : initializeApp(firebaseConfig);\n\nexport const db = getFirestore(app);\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,WAAW;IACX,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;IACL,aAAa;AACf;AAEA,MAAM,MAAM,IAAA,6KAAO,IAAG,MAAM,GAAG,IAAA,4KAAM,MAAK,IAAA,mLAAa,EAAC;AAEjD,MAAM,KAAK,IAAA,mLAAY,EAAC"}},
    {"offset": {"line": 162, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/lib/firebaseAuth.ts"],"sourcesContent":["type ResolveResult = {\n  uid: string | null;\n};\n\nasync function lookupUid(token: string, apiKey: string) {\n  const res = await fetch(\n    `https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${apiKey}`,\n    {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ idToken: token })\n    }\n  );\n\n  if (!res.ok) return null;\n  const data = await res.json();\n  return data?.users?.[0]?.localId || null;\n}\n\nexport async function resolveUid(authHeader: string | null): Promise<ResolveResult> {\n  if (!authHeader?.startsWith(\"Bearer \")) return { uid: null };\n  const token = authHeader.slice(7);\n\n  if (token.startsWith(\"dev-\")) {\n    return { uid: \"dev\" };\n  }\n\n  const apiKey = process.env.NEXT_PUBLIC_FIREBASE_API_KEY;\n  if (!apiKey) return { uid: null };\n\n  const uid = await lookupUid(token, apiKey);\n  return { uid };\n}\n"],"names":[],"mappings":";;;;AAIA,eAAe,UAAU,KAAa,EAAE,MAAc;IACpD,MAAM,MAAM,MAAM,MAChB,CAAC,8DAA8D,EAAE,QAAQ,EACzE;QACE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE,SAAS;QAAM;IACxC;IAGF,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;IACpB,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO,MAAM,OAAO,CAAC,EAAE,EAAE,WAAW;AACtC;AAEO,eAAe,WAAW,UAAyB;IACxD,IAAI,CAAC,YAAY,WAAW,YAAY,OAAO;QAAE,KAAK;IAAK;IAC3D,MAAM,QAAQ,WAAW,KAAK,CAAC;IAE/B,IAAI,MAAM,UAAU,CAAC,SAAS;QAC5B,OAAO;YAAE,KAAK;QAAM;IACtB;IAEA,MAAM;IACN;;IAEA,MAAM,MAAM,MAAM,UAAU,OAAO;IACnC,OAAO;QAAE;IAAI;AACf"}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/app/api/ownercover/handleInbound/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { doc, getDoc, addDoc, collection } from \"firebase/firestore\";\nimport { db } from \"../../../../lib/firebaseServer\";\nimport { resolveUid } from \"../../../../lib/firebaseAuth\";\n\nconst DEFAULT_SETTINGS = {\n  mode: \"monitor\",\n  confidenceThreshold: 0.85,\n  restrictedTopics: [\"billing\", \"complaints\", \"legal\"]\n};\n\nfunction decideAction(settings: typeof DEFAULT_SETTINGS, text: string) {\n  const lower = text.toLowerCase();\n  const restricted = settings.restrictedTopics.some(topic => lower.includes(topic));\n  const confidence = restricted ? 0.6 : 0.9;\n  const action =\n    settings.mode === \"off\"\n      ? \"monitor\"\n      : settings.mode === \"monitor\"\n        ? \"await-approval\"\n        : confidence >= settings.confidenceThreshold && !restricted\n          ? \"auto-send\"\n          : \"await-approval\";\n  return { action, confidence, restricted };\n}\n\nexport async function POST(request: Request) {\n  const { uid } = await resolveUid(request.headers.get(\"authorization\"));\n  if (!uid) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n\n  const body = await request.json().catch(() => ({}));\n  const text = String(body?.text || \"\");\n\n  const settingsRef = doc(db, \"ownerCoverSettings\", uid);\n  const settingsSnap = await getDoc(settingsRef);\n  const settings = settingsSnap.exists()\n    ? { ...DEFAULT_SETTINGS, ...settingsSnap.data() }\n    : DEFAULT_SETTINGS;\n\n  const decision = decideAction(settings as typeof DEFAULT_SETTINGS, text);\n\n  await addDoc(collection(db, \"ownerCoverEvents\"), {\n    uid,\n    timestamp: Date.now(),\n    incoming: body,\n    settings,\n    ...decision\n  });\n\n  return NextResponse.json({\n    ok: true,\n    ...decision,\n    summary: \"Inbound handled by Owner Cover.\",\n    incoming: body\n  });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;AACA;AACA;;;;;AAEA,MAAM,mBAAmB;IACvB,MAAM;IACN,qBAAqB;IACrB,kBAAkB;QAAC;QAAW;QAAc;KAAQ;AACtD;AAEA,SAAS,aAAa,QAAiC,EAAE,IAAY;IACnE,MAAM,QAAQ,KAAK,WAAW;IAC9B,MAAM,aAAa,SAAS,gBAAgB,CAAC,IAAI,CAAC,CAAA,QAAS,MAAM,QAAQ,CAAC;IAC1E,MAAM,aAAa,aAAa,MAAM;IACtC,MAAM,SACJ,SAAS,IAAI,KAAK,QACd,YACA,SAAS,IAAI,KAAK,YAChB,mBACA,cAAc,SAAS,mBAAmB,IAAI,CAAC,aAC7C,cACA;IACV,OAAO;QAAE;QAAQ;QAAY;IAAW;AAC1C;AAEO,eAAe,KAAK,OAAgB;IACzC,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,IAAA,mIAAU,EAAC,QAAQ,OAAO,CAAC,GAAG,CAAC;IACrD,IAAI,CAAC,KAAK,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IAE5E,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IACjD,MAAM,OAAO,OAAO,MAAM,QAAQ;IAElC,MAAM,cAAc,IAAA,0KAAG,EAAC,6HAAE,EAAE,sBAAsB;IAClD,MAAM,eAAe,MAAM,IAAA,6KAAM,EAAC;IAClC,MAAM,WAAW,aAAa,MAAM,KAChC;QAAE,GAAG,gBAAgB;QAAE,GAAG,aAAa,IAAI,EAAE;IAAC,IAC9C;IAEJ,MAAM,WAAW,aAAa,UAAqC;IAEnE,MAAM,IAAA,6KAAM,EAAC,IAAA,iLAAU,EAAC,6HAAE,EAAE,qBAAqB;QAC/C;QACA,WAAW,KAAK,GAAG;QACnB,UAAU;QACV;QACA,GAAG,QAAQ;IACb;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QACvB,IAAI;QACJ,GAAG,QAAQ;QACX,SAAS;QACT,UAAU;IACZ;AACF"}}]
}