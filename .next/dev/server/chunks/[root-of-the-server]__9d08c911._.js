module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/process [external] (process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/http2 [external] (http2, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[project]/lib/firebaseServer.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "db",
    ()=>db
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$app$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/app/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@firebase/app/dist/esm/index.esm.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$firestore$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/firestore/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@firebase/firestore/dist/index.node.mjs [app-route] (ecmascript)");
;
;
const firebaseConfig = {
    apiKey: ("TURBOPACK compile-time value", "AIzaSyBLoFQJatOZYvCiimNqF84cXtg2YpOxp3Y"),
    authDomain: ("TURBOPACK compile-time value", "main-st-ai.firebaseapp.com"),
    databaseURL: ("TURBOPACK compile-time value", "https://main-st-ai-default-rtdb.firebaseio.com"),
    projectId: ("TURBOPACK compile-time value", "main-st-ai"),
    storageBucket: ("TURBOPACK compile-time value", "main-st-ai.firebasestorage.app"),
    messagingSenderId: ("TURBOPACK compile-time value", "816395647058"),
    appId: ("TURBOPACK compile-time value", "1:816395647058:web:06a5bcedae2e11cfdb078b"),
    measurementId: ("TURBOPACK compile-time value", "G-WCZN8L5HSK")
};
const app = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApps"])().length ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getApp"])() : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$app$2f$dist$2f$esm$2f$index$2e$esm$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initializeApp"])(firebaseConfig);
const db = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFirestore"])(app);
}),
"[project]/lib/firebaseAuth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "resolveUid",
    ()=>resolveUid
]);
async function lookupUid(token, apiKey) {
    const res = await fetch(`https://identitytoolkit.googleapis.com/v1/accounts:lookup?key=${apiKey}`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idToken: token
        })
    });
    if (!res.ok) return null;
    const data = await res.json();
    return data?.users?.[0]?.localId || null;
}
async function resolveUid(authHeader) {
    if (!authHeader?.startsWith("Bearer ")) return {
        uid: null
    };
    const token = authHeader.slice(7);
    if (token.startsWith("dev-")) {
        return {
            uid: "dev"
        };
    }
    const apiKey = ("TURBOPACK compile-time value", "AIzaSyBLoFQJatOZYvCiimNqF84cXtg2YpOxp3Y");
    if ("TURBOPACK compile-time falsy", 0) //TURBOPACK unreachable
    ;
    const uid = await lookupUid(token, apiKey);
    return {
        uid
    };
}
}),
"[project]/lib/devStore.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "addAction",
    ()=>addAction,
    "addAudit",
    ()=>addAudit,
    "addChatProfile",
    ()=>addChatProfile,
    "addContact",
    ()=>addContact,
    "addMessage",
    ()=>addMessage,
    "getConversation",
    ()=>getConversation,
    "getOwnerCoverSettings",
    ()=>getOwnerCoverSettings,
    "getProfile",
    ()=>getProfile,
    "listActions",
    ()=>listActions,
    "listAudit",
    ()=>listAudit,
    "listChatProfiles",
    ()=>listChatProfiles,
    "listContacts",
    ()=>listContacts,
    "listIntegrations",
    ()=>listIntegrations,
    "listMessages",
    ()=>listMessages,
    "removeChatProfile",
    ()=>removeChatProfile,
    "removeContact",
    ()=>removeContact,
    "setOwnerCoverSettings",
    ()=>setOwnerCoverSettings,
    "setProfile",
    ()=>setProfile,
    "updateAction",
    ()=>updateAction,
    "updateChatProfile",
    ()=>updateChatProfile,
    "updateContact",
    ()=>updateContact,
    "updateIntegration",
    ()=>updateIntegration
]);
const devProfile = {
    name: "Main St AI",
    services: "Lead response, scheduling, and front-desk coverage",
    hours: "Mon–Fri, 9am–6pm",
    serviceArea: "Local service area",
    pricingNotes: "Pricing varies by service tier; ask clarifying questions.",
    policies: "No legal or refund decisions without owner approval.",
    tone: "Calm, professional, concise.",
    updatedAt: Date.now()
};
let contacts = [];
let conversations = [];
let actions = [];
let audit = [];
let ownerCoverSettings = {
    mode: "monitor",
    confidenceThreshold: 0.85,
    restrictedTopics: [
        "billing",
        "complaints",
        "legal"
    ],
    quietHoursStart: "20:00",
    quietHoursEnd: "07:00",
    quietHoursEnabled: false
};
let chatProfiles = [
    {
        id: "default",
        name: "Default",
        tone: "Calm, professional, concise.",
        responseLength: "balanced",
        model: "mistralai/Mistral-7B-Instruct-v0.2",
        updatedAt: Date.now()
    }
];
let integrations = [
    {
        id: "google",
        name: "Google Workspace",
        status: "disconnected",
        updatedAt: Date.now()
    },
    {
        id: "stripe",
        name: "Stripe",
        status: "disconnected",
        updatedAt: Date.now()
    },
    {
        id: "shopify",
        name: "Shopify",
        status: "disconnected",
        updatedAt: Date.now()
    }
];
function makeId() {
    return `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;
}
function getProfile() {
    return devProfile;
}
function setProfile(next) {
    Object.assign(devProfile, next, {
        updatedAt: Date.now()
    });
    return devProfile;
}
function listContacts() {
    return contacts;
}
function addContact(input) {
    const now = Date.now();
    const contact = {
        id: makeId(),
        name: String(input.name || ""),
        email: String(input.email || ""),
        phone: String(input.phone || ""),
        notes: String(input.notes || ""),
        tags: Array.isArray(input.tags) ? input.tags : [],
        status: String(input.status || "new"),
        lastContact: null,
        createdAt: now,
        updatedAt: now
    };
    contacts.unshift(contact);
    return contact;
}
function updateContact(id, input) {
    const idx = contacts.findIndex((c)=>c.id === id);
    if (idx === -1) return null;
    contacts[idx] = {
        ...contacts[idx],
        ...input,
        updatedAt: Date.now()
    };
    return contacts[idx];
}
function removeContact(id) {
    const before = contacts.length;
    contacts = contacts.filter((c)=>c.id !== id);
    return contacts.length < before;
}
function getConversation(id) {
    let convo = conversations.find((c)=>c.id === id);
    if (!convo) {
        convo = {
            id,
            uid: "dev",
            messages: [],
            updatedAt: Date.now()
        };
        conversations.push(convo);
    }
    return convo;
}
function addMessage(conversationId, role, content) {
    const convo = getConversation(conversationId);
    const message = {
        role,
        content,
        createdAt: Date.now()
    };
    convo.messages.push(message);
    convo.updatedAt = Date.now();
    return message;
}
function listMessages(conversationId) {
    return getConversation(conversationId).messages;
}
function addAction(entry) {
    const action = {
        id: makeId(),
        uid: "dev",
        status: entry.status || "queued",
        action: entry.action,
        confidence: entry.confidence,
        restricted: entry.restricted,
        response: entry.response,
        reason: entry.reason,
        message: entry.message,
        createdAt: Date.now()
    };
    actions.unshift(action);
    return action;
}
function listActions() {
    return actions;
}
function updateAction(id, status) {
    const idx = actions.findIndex((a)=>a.id === id);
    if (idx === -1) return null;
    actions[idx] = {
        ...actions[idx],
        status
    };
    return actions[idx];
}
function addAudit(event) {
    const entry = {
        ...event,
        id: makeId(),
        createdAt: Date.now()
    };
    audit.unshift(entry);
    return entry;
}
function listAudit() {
    return audit;
}
function getOwnerCoverSettings() {
    return ownerCoverSettings;
}
function setOwnerCoverSettings(next) {
    ownerCoverSettings = {
        ...ownerCoverSettings,
        ...next
    };
    return ownerCoverSettings;
}
function listChatProfiles() {
    return chatProfiles;
}
function addChatProfile(input) {
    const profile = {
        id: makeId(),
        name: String(input.name || "New profile"),
        tone: String(input.tone || "Calm, professional, concise."),
        responseLength: input.responseLength || "balanced",
        model: String(input.model || "mistralai/Mistral-7B-Instruct-v0.2"),
        updatedAt: Date.now()
    };
    chatProfiles.unshift(profile);
    return profile;
}
function updateChatProfile(id, input) {
    const idx = chatProfiles.findIndex((p)=>p.id === id);
    if (idx === -1) return null;
    chatProfiles[idx] = {
        ...chatProfiles[idx],
        ...input,
        updatedAt: Date.now()
    };
    return chatProfiles[idx];
}
function removeChatProfile(id) {
    const before = chatProfiles.length;
    chatProfiles = chatProfiles.filter((p)=>p.id !== id);
    return chatProfiles.length < before;
}
function listIntegrations() {
    return integrations;
}
function updateIntegration(id, status) {
    const idx = integrations.findIndex((i)=>i.id === id);
    if (idx === -1) return null;
    integrations[idx] = {
        ...integrations[idx],
        status,
        updatedAt: Date.now()
    };
    return integrations[idx];
}
}),
"[project]/app/api/chat/history/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$firebase$2f$firestore$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i("[project]/node_modules/firebase/firestore/dist/index.mjs [app-route] (ecmascript) <locals>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@firebase/firestore/dist/index.node.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$firebaseServer$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/firebaseServer.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$firebaseAuth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/firebaseAuth.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$devStore$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/devStore.ts [app-route] (ecmascript)");
;
;
;
;
;
async function GET(request) {
    const { uid } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$firebaseAuth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveUid"])(request.headers.get("authorization"));
    if (!uid) return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
        error: "Unauthorized"
    }, {
        status: 401
    });
    const { searchParams } = new URL(request.url);
    const conversationId = searchParams.get("conversationId") || `${uid}-default`;
    if (uid === "dev") {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json((0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$devStore$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["listMessages"])(conversationId));
    }
    const convoRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["doc"])(__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$firebaseServer$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"], "conversations", conversationId);
    const messagesRef = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["collection"])(convoRef, "messages");
    const q = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["query"])(messagesRef, (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["orderBy"])("createdAt", "asc"));
    const snap = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$firebase$2f$firestore$2f$dist$2f$index$2e$node$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDocs"])(q);
    const data = snap.docs.map((docSnap)=>docSnap.data());
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(data);
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__9d08c911._.js.map