{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/app/memory/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../lib/api\";\nimport { canUseRealtime, subscribeCollection } from \"../../lib/realtime\";\nimport { getAuth } from \"../../lib/auth\";\n\nexport default function MemoryViewer() {\n  const [contacts, setContacts] = useState<any[]>([]);\n  const [selected, setSelected] = useState<string>(\"\");\n  const [threads, setThreads] = useState<any[]>([]);\n  const [messages, setMessages] = useState<any[]>([]);\n  const [decisions, setDecisions] = useState<any[]>([]);\n  const [outcomes, setOutcomes] = useState<any[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState<\"timeline\" | \"decisions\" | \"outcomes\">(\"timeline\");\n\n  async function loadContacts() {\n    try {\n      const data = await api.contacts();\n      setContacts(data || []);\n      if (data && data.length && !selected) {\n        setSelected(data[0].id || \"\");\n      }\n    } catch (e: any) {\n      setError(e?.message || String(e));\n    }\n  }\n\n  async function loadDetails(contactId: string) {\n    if (!contactId) return;\n    try {\n      const t = await api.threads(contactId);\n      setThreads(t || []);\n      const d = await api.decisions(contactId);\n      setDecisions(d || []);\n      const o = await api.outcomes(contactId);\n      setOutcomes(o || []);\n      if (t && t.length) {\n        const msgs = await api.threadMessages(t[0].id);\n        setMessages(msgs || []);\n      } else {\n        setMessages([]);\n      }\n    } catch (e: any) {\n      setError(e?.message || String(e));\n    }\n  }\n\n  useEffect(() => {\n    const auth = getAuth();\n    const uid = auth?.uid;\n    if (uid && canUseRealtime()) {\n      const unsub = subscribeCollection([\"users\", uid, \"contacts\"], \"last_touch_ts\", rows => {\n        setContacts(rows);\n        if (rows.length && !selected) setSelected(rows[0].id || \"\");\n      });\n      if (!unsub) loadContacts();\n      return () => {\n        if (typeof unsub === \"function\") unsub();\n      };\n    }\n    loadContacts();\n  }, []);\n\n  useEffect(() => {\n    const auth = getAuth();\n    const uid = auth?.uid;\n    if (!selected) return;\n    if (uid && canUseRealtime()) {\n      const unsubThreads = subscribeCollection([\"users\", uid, \"threads\"], \"last_message_ts\", rows => {\n        const filtered = rows.filter(r => r.contact_id === selected);\n        setThreads(filtered);\n        if (filtered.length) {\n          api.threadMessages(filtered[0].id).then(setMessages).catch(() => {});\n        } else {\n          setMessages([]);\n        }\n      });\n      const unsubDecisions = subscribeCollection([\"users\", uid, \"decisions\"], \"created_ts\", rows => {\n        setDecisions(rows.filter(r => r.contact_id === selected));\n      });\n      const unsubOutcomes = subscribeCollection([\"users\", uid, \"outcomes\"], \"ts\", rows => {\n        setOutcomes(rows.filter(r => r.contact_id === selected));\n      });\n      return () => {\n        if (typeof unsubThreads === \"function\") unsubThreads();\n        if (typeof unsubDecisions === \"function\") unsubDecisions();\n        if (typeof unsubOutcomes === \"function\") unsubOutcomes();\n      };\n    }\n    loadDetails(selected);\n  }, [selected]);\n\n  return (\n    <div className=\"stagger\">\n      <div>\n        <span className=\"pill\">Memory System</span>\n        <h2 className=\"section-title\">Memory viewer</h2>\n        <p className=\"muted\">Contacts, threads, decisions, and outcomes in one place.</p>\n      </div>\n\n      {error && <div className=\"muted\">Error: {error}</div>}\n\n      <div className=\"feature-grid\">\n        <div className=\"card\">\n          <h3 className=\"section-title\">Contacts</h3>\n          {contacts.length === 0 ? (\n            <div className=\"muted\">No contacts yet.</div>\n          ) : (\n            <div className=\"timeline\">\n              {contacts.map(contact => (\n                <div\n                  className=\"timeline-item\"\n                  key={contact.id}\n                  onClick={() => setSelected(contact.id)}\n                  style={{ cursor: \"pointer\" }}\n                >\n                  <span className=\"dot\" />\n                  <div>\n                    <strong>{contact.name || contact.id}</strong>\n                    <div className=\"muted\">{contact.email || \"No email\"}</div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <div className=\"card\">\n          <div className=\"row\" style={{ justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <h3 className=\"section-title\">Timeline</h3>\n            <div className=\"row\">\n              <button className=\"btn ghost\" onClick={()=>setActiveTab(\"timeline\")}>Messages</button>\n              <button className=\"btn ghost\" onClick={()=>setActiveTab(\"decisions\")}>Decisions</button>\n              <button className=\"btn ghost\" onClick={()=>setActiveTab(\"outcomes\")}>Outcomes</button>\n            </div>\n          </div>\n\n          {activeTab === \"timeline\" && (\n            <div>\n              {messages.length === 0 ? (\n                <div className=\"muted\">No messages for this contact.</div>\n              ) : (\n                <div className=\"timeline\">\n                  {messages.map((m: any, idx: number) => (\n                    <div className=\"timeline-item\" key={`${m.id || idx}`}>\n                      <span className=\"dot\" />\n                      <div>\n                        <strong>{m.role}</strong>\n                        <div className=\"muted\">{m.text}</div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {activeTab === \"decisions\" && (\n            <div>\n              {decisions.length === 0 ? (\n                <div className=\"muted\">No decisions for this contact.</div>\n              ) : (\n                <div className=\"timeline\">\n                  {decisions.map((d: any) => (\n                    <div className=\"timeline-item\" key={d.id}>\n                      <span className=\"dot\" />\n                      <div>\n                        <strong>{d.intent}</strong>\n                        <div className=\"muted\">{d.reason}</div>\n                        <div className=\"row\" style={{ marginTop: 6 }}>\n                          <span className=\"badge\">{d.decision}</span>\n                          <span className=\"badge\">Confidence {Math.round((d.confidence || 0) * 100)}%</span>\n                          {d.risk !== undefined && (\n                            <span className=\"badge\">Risk {Math.round(d.risk * 100)}%</span>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n\n          {activeTab === \"outcomes\" && (\n            <div>\n              {outcomes.length === 0 ? (\n                <div className=\"muted\">No outcomes for this contact.</div>\n              ) : (\n                <div className=\"timeline\">\n                  {outcomes.map((o: any) => (\n                    <div className=\"timeline-item\" key={o.id}>\n                      <span className=\"dot\" />\n                      <div>\n                        <strong>{o.type}</strong>\n                        <div className=\"muted\">{o.note || \"No note\"}</div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}