{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/app/automation/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../lib/api\";\n\ntype Rule = {\n  id: string;\n  name: string;\n  trigger: string;\n  action: string;\n  status: \"active\" | \"paused\";\n  risk: \"low\" | \"medium\" | \"high\";\n};\n\ntype Guardrail = {\n  id: string;\n  label: string;\n  description: string;\n  enabled: boolean;\n};\n\nconst defaultRules: Rule[] = [\n  {\n    id: \"rule-hours\",\n    name: \"After-hours routing\",\n    trigger: \"Inbound outside business hours\",\n    action: \"Queue for approval + after-hours response\",\n    status: \"active\",\n    risk: \"low\"\n  },\n  {\n    id: \"rule-pricing\",\n    name: \"Pricing intent\",\n    trigger: \"Customer asks about pricing\",\n    action: \"Send approved range + request one detail\",\n    status: \"active\",\n    risk: \"medium\"\n  },\n  {\n    id: \"rule-complaint\",\n    name: \"Complaint escalation\",\n    trigger: \"Complaint or refund keywords\",\n    action: \"Escalate to owner + draft response\",\n    status: \"active\",\n    risk: \"high\"\n  }\n];\n\nconst defaultGuardrails: Guardrail[] = [\n  {\n    id: \"gr-confidence\",\n    label: \"Minimum confidence\",\n    description: \"Block auto-send if confidence drops below 0.70.\",\n    enabled: true\n  },\n  {\n    id: \"gr-money\",\n    label: \"Money approval\",\n    description: \"Require approval for pricing, invoices, or refunds.\",\n    enabled: true\n  },\n  {\n    id: \"gr-legal\",\n    label: \"Legal escalation\",\n    description: \"Escalate legal or complaint language immediately.\",\n    enabled: true\n  },\n  {\n    id: \"gr-quiet\",\n    label: \"Quiet hours\",\n    description: \"Prevent auto-send outside business hours.\",\n    enabled: false\n  }\n];\n\nfunction makeId(prefix: string) {\n  if (typeof crypto !== \"undefined\" && \"randomUUID\" in crypto) {\n    return `${prefix}-${crypto.randomUUID()}`;\n  }\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n\nexport default function Automation() {\n  const [rules, setRules] = useState<Rule[]>(defaultRules);\n  const [guardrails, setGuardrails] = useState<Guardrail[]>(defaultGuardrails);\n  const [role, setRole] = useState<\"Owner\" | \"Manager\" | \"Agent\">(\"Owner\");\n  const [newRule, setNewRule] = useState({\n    name: \"\",\n    trigger: \"\",\n    action: \"\",\n    risk: \"medium\" as Rule[\"risk\"]\n  });\n  const [saved, setSaved] = useState<string | null>(null);\n\n  useEffect(() => {\n    api.automationRules()\n      .then((data) => setRules(data || defaultRules))\n      .catch(() => setRules(defaultRules));\n    api.automationGuardrails()\n      .then((data) => setGuardrails(data || defaultGuardrails))\n      .catch(() => setGuardrails(defaultGuardrails));\n    api.accessGet()\n      .then((data) => setRole(data?.role || \"Owner\"))\n      .catch(() => setRole(\"Owner\"));\n  }, []);\n\n  function toggleGuardrail(id: string) {\n    const next = guardrails.map(g => (g.id === id ? { ...g, enabled: !g.enabled } : g));\n    setGuardrails(next);\n    api.automationGuardrailsSet(next).catch(() => null);\n  }\n\n  function toggleRule(id: string) {\n    const next = rules.map(r =>\n      r.id === id ? { ...r, status: r.status === \"active\" ? \"paused\" : \"active\" } : r\n    );\n    setRules(next);\n    api.automationRulesSet(next).catch(() => null);\n  }\n\n  function addRule() {\n    if (!newRule.name || !newRule.trigger || !newRule.action) return;\n    const rule: Rule = {\n      id: makeId(\"rule\"),\n      name: newRule.name,\n      trigger: newRule.trigger,\n      action: newRule.action,\n      status: \"active\",\n      risk: newRule.risk\n    };\n    const next = [rule, ...rules];\n    setRules(next);\n    api.automationRulesSet(next).catch(() => null);\n    setNewRule({ name: \"\", trigger: \"\", action: \"\", risk: \"medium\" });\n    setSaved(\"Rule added.\");\n    setTimeout(() => setSaved(null), 2200);\n  }\n\n  return (\n    <div className=\"stagger\">\n      <div className=\"row\" style={{ alignItems: \"center\", justifyContent: \"space-between\" }}>\n        <div>\n          <span className=\"pill\">Automation Studio</span>\n          <h2 className=\"section-title\">Design how the Decision Core acts</h2>\n        </div>\n        <a className=\"btn primary\" href=\"/owner-cover\">Owner Cover settings</a>\n      </div>\n\n      {role === \"Agent\" && (\n        <div className=\"card\">\n          <h3 className=\"section-title\">Limited access</h3>\n          <p className=\"muted\">\n            Automation Studio is available to Owners and Managers. Ask your Owner to grant access.\n          </p>\n        </div>\n      )}\n\n      {role === \"Agent\" ? null : (\n        <>\n      <div className=\"card\">\n        <h3 className=\"section-title\">Guardrails</h3>\n        <p className=\"muted\">Guardrails keep the AI safe and explainable before it takes action.</p>\n        <div className=\"table\" style={{ marginTop: 12 }}>\n          {guardrails.map(item => (\n            <div className=\"table-row\" key={item.id}>\n              <div>\n                <strong>{item.label}</strong>\n                <div className=\"muted\">{item.description}</div>\n              </div>\n              <span className={`status-pill ${item.enabled ? \"\" : \"warn\"}`}>\n                <span className=\"status-dot\" />\n                {item.enabled ? \"Enabled\" : \"Disabled\"}\n              </span>\n              <div className=\"muted\">Policy</div>\n              <button className=\"btn ghost\" onClick={() => toggleGuardrail(item.id)}>\n                {item.enabled ? \"Disable\" : \"Enable\"}\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"card\">\n        <div className=\"row\" style={{ alignItems: \"center\", justifyContent: \"space-between\" }}>\n          <h3 className=\"section-title\">Automation rules</h3>\n          {saved && <span className=\"muted\">{saved}</span>}\n        </div>\n        <div className=\"table\" style={{ marginTop: 12 }}>\n          <div className=\"table-row table-header\">\n            <span>Rule</span>\n            <span>Risk</span>\n            <span>Status</span>\n            <span>Actions</span>\n          </div>\n          {rules.map(rule => (\n            <div className=\"table-row\" key={rule.id}>\n              <div>\n                <strong>{rule.name}</strong>\n                <div className=\"muted\">Trigger: {rule.trigger}</div>\n                <div className=\"muted\">Action: {rule.action}</div>\n              </div>\n              <span className={`status-pill ${rule.risk === \"high\" ? \"warn\" : \"\"}`}>\n                <span className=\"status-dot\" />\n                {rule.risk}\n              </span>\n              <span className={`status-pill ${rule.status === \"active\" ? \"\" : \"warn\"}`}>\n                <span className=\"status-dot\" />\n                {rule.status}\n              </span>\n              <button className=\"btn ghost\" onClick={() => toggleRule(rule.id)}>\n                {rule.status === \"active\" ? \"Pause\" : \"Activate\"}\n              </button>\n            </div>\n          ))}\n        </div>\n\n        <div className=\"settings-grid\" style={{ marginTop: 16 }}>\n          <div>\n            <label className=\"muted\">Rule name</label>\n            <input\n              className=\"input\"\n              placeholder=\"e.g. High-value lead follow-up\"\n              value={newRule.name}\n              onChange={e => setNewRule({ ...newRule, name: e.target.value })}\n            />\n          </div>\n          <div>\n            <label className=\"muted\">Trigger</label>\n            <input\n              className=\"input\"\n              placeholder=\"e.g. Lead tagged VIP\"\n              value={newRule.trigger}\n              onChange={e => setNewRule({ ...newRule, trigger: e.target.value })}\n            />\n          </div>\n          <div>\n            <label className=\"muted\">Action</label>\n            <input\n              className=\"input\"\n              placeholder=\"e.g. Auto-send with premium response\"\n              value={newRule.action}\n              onChange={e => setNewRule({ ...newRule, action: e.target.value })}\n            />\n          </div>\n          <div>\n            <label className=\"muted\">Risk</label>\n            <select\n              className=\"select\"\n              value={newRule.risk}\n              onChange={e => setNewRule({ ...newRule, risk: e.target.value as Rule[\"risk\"] })}\n            >\n              <option value=\"low\">low</option>\n              <option value=\"medium\">medium</option>\n              <option value=\"high\">high</option>\n            </select>\n          </div>\n        </div>\n        <div className=\"row\" style={{ marginTop: 12 }}>\n          <button className=\"btn primary\" onClick={addRule}>Add rule</button>\n          <button className=\"btn ghost\">Export rules</button>\n        </div>\n      </div>\n\n      <div className=\"card\">\n        <h3 className=\"section-title\">Playbooks</h3>\n        <p className=\"muted\">Pre-approved response playbooks for high-volume scenarios.</p>\n        <div className=\"feature-grid\" style={{ marginTop: 12 }}>\n          <div className=\"feature-card\">\n            <strong>Lead follow-up</strong>\n            <p className=\"muted\">Auto-send in 24h if no reply, then queue if still idle.</p>\n            <button className=\"btn ghost\">Configure</button>\n          </div>\n          <div className=\"feature-card\">\n            <strong>Booking flow</strong>\n            <p className=\"muted\">Collect service, date, time, and hand off to owner.</p>\n            <button className=\"btn ghost\">Configure</button>\n          </div>\n          <div className=\"feature-card\">\n            <strong>Refund protection</strong>\n            <p className=\"muted\">Escalate to owner with prewritten responses.</p>\n            <button className=\"btn ghost\">Configure</button>\n          </div>\n        </div>\n      </div>\n        </>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}