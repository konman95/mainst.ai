{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/app/chat/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../lib/api\";\nimport { canUseRealtime, subscribeCollection } from \"../../lib/realtime\";\nimport { getAuth } from \"../../lib/auth\";\n\nexport default function Chat() {\n  const [msg,setMsg]=useState(\"\");\n  const [out,setOut]=useState(\"\");\n  const [error,setError]=useState<string | null>(null);\n  const [loading,setLoading]=useState(false);\n  const [conversationId,setConversationId]=useState(\"\");\n  const [messages,setMessages]=useState<any[]>([]);\n  const [manual,setManual]=useState(\"\");\n\n  useEffect(()=>{\n    let active = true;\n    let interval: number | null = null;\n    async function loadHistory() {\n      try {\n        const data = await api.chatHistory(conversationId);\n        if (active) setMessages(data || []);\n      } catch (e:any) {\n        if (active) setError(e?.message || String(e));\n      }\n    }\n    if (!conversationId || !canUseRealtime()) {\n      loadHistory();\n      interval = window.setInterval(loadHistory, 5000);\n      return () => {\n        active = false;\n        if (interval) window.clearInterval(interval);\n      };\n    }\n    return () => {\n      active = false;\n      if (interval) window.clearInterval(interval);\n    };\n  },[conversationId]);\n  useEffect(() => {\n    const auth = getAuth();\n    const uid = auth?.uid;\n    if (!uid || !conversationId || !canUseRealtime()) return;\n    const pathParts = [\"users\", uid, \"threads\", conversationId, \"messages\"];\n    const unsub = subscribeCollection(pathParts, \"ts\", rows => setMessages(rows));\n    return () => {\n      if (typeof unsub === \"function\") unsub();\n    };\n  }, [conversationId]);\n\n  async function refreshHistory(nextId: string) {\n    const data = await api.chatHistory(nextId);\n    setMessages(data || []);\n  }\n\n  return (\n    <div className=\"stagger\">\n      <div>\n        <span className=\"pill\">Smart Chat</span>\n        <h2 className=\"section-title\">Live conversation</h2>\n        <p className=\"muted\">Calm, professional responses that match your business voice.</p>\n      </div>\n\n      <div className=\"card\">\n        <div className=\"row\" style={{ alignItems: \"center\", justifyContent: \"space-between\" }}>\n          <strong>Conversation</strong>\n          <span className=\"badge\">Owner ready</span>\n        </div>\n        <div className=\"card tight\" style={{ marginTop: 16 }}>\n          {messages.length === 0 ? (\n            <div className=\"muted\">No messages yet.</div>\n          ) : (\n            <div className=\"timeline\">\n              {messages.map((m:any, idx:number) => (\n                <div className=\"timeline-item\" key={`${m.createdAt}-${idx}`}>\n                  <span className=\"dot\" />\n                  <div>\n                    <strong>{m.role === \"assistant\" ? \"Assistant\" : \"Customer\"}</strong>\n                    <div className=\"muted\">{m.text || m.content}</div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n        <div style={{ marginTop: 16 }}>\n          <input\n            className=\"input\"\n            placeholder=\"Type a customer question...\"\n            value={msg}\n            onChange={e=>setMsg(e.target.value)}\n          />\n        </div>\n        <div className=\"hero-actions\">\n          <button className=\"btn primary\" disabled={loading} onClick={async()=>{\n            setLoading(true);\n            setError(null);\n            try {\n              const r=await api.chat({message:msg, conversationId});\n              setOut(r?.reply ?? \"\");\n              if (r?.thread_id) setConversationId(r.thread_id);\n              await refreshHistory(r?.thread_id || conversationId);\n            } catch (e:any) {\n              setError(e?.message || String(e));\n            } finally {\n              setLoading(false);\n            }\n          }}>{loading ? \"Sending...\" : \"Send reply\"}</button>\n          <button className=\"btn ghost\" onClick={()=>{ setMsg(\"\"); setOut(\"\"); }}>Clear</button>\n        </div>\n        {error && <div className=\"muted\">Error: {error}</div>}\n        <div className=\"card tight\" style={{ marginTop: 16 }}>\n          <div className=\"muted\" style={{ marginBottom: 8 }}>Suggested response</div>\n          <pre style={{ margin: 0 }}>{out || \"No response yet.\"}</pre>\n        </div>\n        <div style={{ marginTop: 16 }}>\n          <div className=\"muted\" style={{ marginBottom: 8 }}>Manual override</div>\n          <textarea\n            className=\"textarea\"\n            placeholder=\"Edit or write a manual response...\"\n            value={manual}\n            onChange={e=>setManual(e.target.value)}\n          />\n          <div className=\"row\" style={{ marginTop: 8 }}>\n            <button\n              className=\"btn ghost\"\n              onClick={async()=>{\n                if (!manual.trim()) return;\n                try {\n                  await api.chatManual({ conversationId, response: manual });\n                  setManual(\"\");\n                  await refreshHistory(conversationId);\n                } catch (e:any) {\n                  setError(e?.message || String(e));\n                }\n              }}\n            >\n              Send manual reply\n            </button>\n          </div>\n        </div>\n        <div className=\"row\" style={{ marginTop: 12 }}>\n          <span className=\"badge\">Conversation: {conversationId || \"default\"}</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}