{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/konnerwest/mainst1/mainstai/app/action-queue/page.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { api } from \"../../lib/api\";\nimport { subscribeCollection } from \"../../lib/realtime\";\nimport { getAuth } from \"../../lib/auth\";\n\nexport default function ActionQueue() {\n  const [actions, setActions] = useState<any[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [view, setView] = useState<\"pending\" | \"all\">(\"pending\");\n  const [tick, setTick] = useState(0);\n\n  async function load() {\n    setError(null);\n    setLoading(true);\n    try {\n      const data = await api.actionQueue();\n      setActions(data || []);\n    } catch (e: any) {\n      setError(e?.message || String(e));\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    let interval: number | null = null;\n    const auth = getAuth();\n    const uid = auth?.uid;\n    if (uid) {\n      const unsub = subscribeCollection([\"users\", uid, \"actionQueue\"], \"created_ts\", rows => setActions(rows));\n      if (!unsub) {\n        load();\n        interval = window.setInterval(load, 5000);\n      }\n      return () => {\n        if (typeof unsub === \"function\") unsub();\n        if (interval) window.clearInterval(interval);\n      };\n    }\n    load();\n    return () => {};\n  }, []);\n\n  useEffect(() => {\n    const interval = window.setInterval(() => setTick(t => t + 1), 60000);\n    return () => window.clearInterval(interval);\n  }, []);\n\n  async function decide(id: string, approve: boolean) {\n    setError(null);\n    try {\n      await api.approveAction(id, approve);\n      await load();\n    } catch (e: any) {\n      setError(e?.message || String(e));\n    }\n  }\n\n  async function approveAll() {\n    setError(null);\n    try {\n      const pending = actions.filter(a => a.status === \"needs_approval\");\n      for (const item of pending) {\n        await api.approveAction(item.id, true);\n      }\n      await load();\n    } catch (e: any) {\n      setError(e?.message || String(e));\n    }\n  }\n\n  const visible = view === \"pending\"\n    ? actions.filter(a => a.status === \"needs_approval\")\n    : actions;\n\n  void tick;\n\n  return (\n    <div className=\"stagger\">\n      <div>\n        <span className=\"pill\">Approvals</span>\n        <h2 className=\"section-title\">Action queue</h2>\n        <p className=\"muted\">Approve, deny, or review queued actions.</p>\n      </div>\n\n      <div className=\"row\">\n        <button className=\"btn ghost\" onClick={load}>Refresh</button>\n        <select className=\"select\" value={view} onChange={e=>setView(e.target.value as any)}>\n          <option value=\"pending\">Pending</option>\n          <option value=\"all\">All</option>\n        </select>\n        <button className=\"btn primary\" onClick={approveAll}>Approve all</button>\n      </div>\n\n      {error && <div className=\"muted\">Error: {error}</div>}\n\n      <div className=\"card\">\n        {loading ? (\n          <div className=\"muted\">Loading...</div>\n        ) : visible.length === 0 ? (\n          <div className=\"muted\">No actions in queue.</div>\n        ) : (\n          <div className=\"timeline\">\n            {visible.map((a: any) => (\n              <div className=\"timeline-item\" key={a.id}>\n                <span className=\"dot\" />\n                <div>\n                  <strong>Owner Cover action</strong>\n                  <div className=\"muted\">{a.draft || a.reason}</div>\n                  <div className=\"muted\">Status: {a.status}</div>\n                  <div className=\"muted\">Confidence: {a.confidence}</div>\n                  <div className=\"row\" style={{ marginTop: 6 }}>\n                    <span className=\"badge\">Priority {a.confidence >= 0.85 ? \"High\" : a.confidence >= 0.7 ? \"Medium\" : \"Low\"}</span>\n                    {a.reason && a.reason.toLowerCase().includes(\"money\") && (\n                      <span className=\"badge\">Risk: Money</span>\n                    )}\n                    {a.reason && a.reason.toLowerCase().includes(\"escalation\") && (\n                      <span className=\"badge\">Risk: Escalation</span>\n                    )}\n                    {a.created_ts && (() => {\n                      const ageMin = Math.max(0, Math.round((Date.now() / 1000 - a.created_ts) / 60));\n                      const sla = ageMin >= 60 ? \"Breach\" : ageMin >= 30 ? \"Warning\" : \"On time\";\n                      return (\n                        <>\n                          <span className=\"badge\">Age {ageMin}m</span>\n                          <span className=\"badge\">SLA {sla}</span>\n                        </>\n                      );\n                    })()}\n                  </div>\n                  <div className=\"row\" style={{ marginTop: 8 }}>\n                    {a.status === \"needs_approval\" && (\n                      <>\n                        <button className=\"btn ghost\" onClick={() => decide(a.id, true)}>Approve</button>\n                        <button className=\"btn ghost\" onClick={() => decide(a.id, false)}>Deny</button>\n                      </>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}